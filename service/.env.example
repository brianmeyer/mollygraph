# MollyGraph Service — Example Configuration
# Copy to .env (next to this file) and fill in your values.
# Variables that are commented out are optional; defaults are shown.

# ── Core server ────────────────────────────────────────────────────────────────
# HTTP host and port the service listens on.
GRAPH_MEMORY_HOST=127.0.0.1
GRAPH_MEMORY_PORT=7422

# Bearer token required by every API endpoint.
MOLLYGRAPH_API_KEY=dev-key-change-in-production

# Runtime profile: hybrid (default) | strict_ai | local
# MOLLYGRAPH_RUNTIME_PROFILE=hybrid

# Set to true to disable all external service calls (Neo4j, LLMs, etc.).
# Useful for unit tests and CI.
# MOLLYGRAPH_TEST_MODE=false

# ── Storage paths ──────────────────────────────────────────────────────────────
# Root data directory (all persistent files live here).
# Defaults to ~/.graph-memory
# MOLLYGRAPH_HOME_DIR=~/.graph-memory

# Individual path overrides (rarely needed — change MOLLYGRAPH_HOME_DIR instead).
# MOLLYGRAPH_QUEUE_DB=~/.graph-memory/extraction_queue.db
# MOLLYGRAPH_SQLITE_VEC_DB=~/.graph-memory/vectors.db
# MOLLYGRAPH_ZVEC_DIR=~/.graph-memory/zvec_collection

# ── Neo4j ─────────────────────────────────────────────────────────────────────
# Connection details for the Neo4j instance.
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=mollygraph

# ── API keys ───────────────────────────────────────────────────────────────────
# Set at least one provider key to enable LLM-backed audit / synonym enrichment.
# GOOGLE_API_KEY=
# ANTHROPIC_API_KEY=
# MOONSHOT_API_KEY=
# GROQ_API_KEY=
# OPENAI_API_KEY=
# OPENROUTER_API_KEY=
# TOGETHER_API_KEY=
# FIREWORKS_API_KEY=
# OLLAMA_API_KEY=      # not usually needed for local Ollama

# ── Embedding tiers ────────────────────────────────────────────────────────────
# First tier that succeeds wins; hash is always the final fallback (never fails).
#
# Tier order (comma-separated, tried left-to-right):
# MOLLYGRAPH_EMBEDDING_TIER_ORDER=sentence-transformers,ollama,cloud,hash
#
# sentence-transformers tier (primary default)
MOLLYGRAPH_EMBEDDING_ST_MODEL=jinaai/jina-embeddings-v5-text-nano
# MOLLYGRAPH_EMBEDDING_MODEL=          # generic fallback override (used if ST_MODEL is unset)
#
# ollama tier
# MOLLYGRAPH_EMBEDDING_OLLAMA_MODEL=nomic-embed-text
# OLLAMA_BASE_URL=http://127.0.0.1:11434
#
# cloud tier (requires OPENAI_API_KEY or equivalent)
# MOLLYGRAPH_EMBEDDING_CLOUD_PROVIDER=openai
# MOLLYGRAPH_EMBEDDING_CLOUD_MODEL=text-embedding-3-small
#
# Legacy single-backend override (skips tier chain entirely if set)
# MOLLYGRAPH_EMBEDDING_BACKEND=

# ── Vector store backend ───────────────────────────────────────────────────────
# zvec (default, zero-dependency), sqlite_vec, or auto
# MOLLYGRAPH_VECTOR_BACKEND=zvec

# ── Reranker (optional, off by default) ───────────────────────────────────────
# Cross-encoder reranking of merged graph+vector results.
# MOLLYGRAPH_RERANKER_ENABLED=false
# MOLLYGRAPH_RERANKER_MODEL=jinaai/jina-reranker-v2-base-multilingual

# ── Extractor ─────────────────────────────────────────────────────────────────
# NER/relation extraction backend.
# MOLLYGRAPH_EXTRACTOR_BACKEND=gliner2
# MOLLYGRAPH_EXTRACTOR_MODEL=               # entity model (default: GLINER_BASE_MODEL)
# MOLLYGRAPH_EXTRACTOR_RELATION_MODEL=Babelscape/rebel-large

# ── GLiNER self-improvement ────────────────────────────────────────────────────
# Base model for NER extraction and LoRA fine-tuning.
GLINER_BASE_MODEL=fastino/gliner2-large-v1

# Minimum labelled examples before LoRA is attempted.
# GLINER_FINETUNE_MIN_EXAMPLES=500
# Minimum examples before full fine-tune (no LoRA) is attempted.
# GLINER_FULL_FINETUNE_MIN_EXAMPLES=2000

# Cooldown between training runs.
# GLINER_FINETUNE_COOLDOWN_DAYS=7

# Benchmark delta threshold: new model must beat baseline by this amount.
# GLINER_FINETUNE_BENCHMARK_THRESHOLD=0.05

# LoRA plateau detection (early stopping).
# GLINER_LORA_PLATEAU_WINDOW=3
# GLINER_LORA_PLATEAU_EPSILON=0.01

# Training data scan limit per cycle.
# GLINER_TRAINING_SCAN_LIMIT=4000

# ── GLiREL relation enrichment (optional, off by default) ─────────────────────
# Second-pass relation extractor after GLiNER2.
# MOLLYGRAPH_GLIREL_ENABLED=false
# MOLLYGRAPH_GLIREL_MODEL=jackboyla/glirel-large-v0
# Minimum confidence to add/override GLiREL relations.
# MOLLYGRAPH_GLIREL_CONFIDENCE=0.5
# Minimum confidence to generate silver-label training examples from GLiREL.
# MOLLYGRAPH_GLIREL_TRAINING_THRESHOLD=0.8
# Enable LLM synonym enrichment for GLiREL labels (adds 3 phrasings via LLM).
# MOLLYGRAPH_GLIREL_LLM_SYNONYMS=true

# ── spaCy enrichment (optional, off by default) ────────────────────────────────
# Additive NER enrichment on top of GLiNER2 output.
# MOLLYGRAPH_SPACY_ENRICHMENT=false
# MOLLYGRAPH_SPACY_MODEL=en_core_web_sm
# MOLLYGRAPH_SPACY_MIN_GLINER_ENTITIES=2

# ── Relation schema extension (optional) ──────────────────────────────────────
# Path to a YAML file with additional relation types to merge into the default schema.
# RELATION_SCHEMA_FILE=

# ── Schema auto-adoption ───────────────────────────────────────────────────────
# Maximum new relation/entity types adopted per nightly cycle.
# MOLLYGRAPH_SCHEMA_ADOPTION_LIMIT=3

# ── Audit / Maintenance ────────────────────────────────────────────────────────
# Set to 1 (or true) to enable LLM-backed relationship audit.
# AUDIT_LLM_ENABLED=0

# Audit provider tier chain (deterministic always runs first; LLM tiers fall through):
# MOLLYGRAPH_AUDIT_PROVIDER_TIERS=deterministic,local,primary,fallback

# local tier — e.g. Ollama, no API key required
# MOLLYGRAPH_AUDIT_TIER_LOCAL=ollama
# MOLLYGRAPH_AUDIT_MODEL_LOCAL=llama3.1:8b
# OLLAMA_CHAT_BASE_URL=http://127.0.0.1:11434/v1

# primary tier — cloud LLM tried after local fails
MOLLYGRAPH_AUDIT_TIER_PRIMARY=moonshot
MOLLYGRAPH_AUDIT_MODEL_PRIMARY=kimi-k2.5

# fallback tier — different provider tried if primary also fails
# MOLLYGRAPH_AUDIT_TIER_FALLBACK=groq
# MOLLYGRAPH_AUDIT_MODEL_FALLBACK=llama-3.3-70b-versatile

# Legacy per-schedule model overrides (still honoured when per-tier model is unset)
# AUDIT_MODEL_NIGHTLY=llama3.1:8b
# AUDIT_MODEL_WEEKLY=llama3.1:8b
# AUDIT_MODEL_PRETRAIN=llama3.1:8b

# Legacy single-provider override (maps to primary tier when AUDIT_TIER_PRIMARY is unset)
# AUDIT_PROVIDER_ORDER=none

# Auto-delete entities flagged by nightly audit (use with care).
# MOLLYGRAPH_AUDIT_AUTO_DELETE=false
# Maximum entities auto-deleted per audit run (absolute cap).
# MOLLYGRAPH_AUDIT_AUTO_DELETE_MAX=15
# Cap as a percentage of relationships reviewed.
# MOLLYGRAPH_AUDIT_AUTO_DELETE_PCT=5

# ── Schema drift alarm thresholds ─────────────────────────────────────────────
# Alert when relationship or entity type count grows by more than N%.
# MOLLYGRAPH_SCHEMA_DRIFT_ALARM_REL_THRESHOLD=25
# MOLLYGRAPH_SCHEMA_DRIFT_ALARM_ENT_THRESHOLD=25

# ── Provider base URLs (override defaults) ────────────────────────────────────
# OLLAMA_BASE_URL=http://127.0.0.1:11434
# OLLAMA_CHAT_BASE_URL=http://127.0.0.1:11434/v1
# MOONSHOT_BASE_URL=https://api.moonshot.ai/v1
# GROQ_BASE_URL=https://api.groq.com/openai/v1
